<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>日志审计 - 系统管理中心</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.css"
    />
  </head>
  <body>
    <div class="sys-admin-container">
      <!-- 侧边栏导航 -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <div class="logo">
            <i class="fas fa-cogs"></i>
            <h2>系统管理中心</h2>
          </div>
          <div class="user-info">
            <div class="avatar">
              <i class="fas fa-user-shield"></i>
            </div>
            <div class="user-details">
              <span class="username" id="username">系统管理员</span>
              <span class="role">系统管理员</span>
            </div>
          </div>
        </div>

        <nav class="sidebar-menu">
          <div class="menu-section">
            <ul>
              <li class="active">
                <a href="logs.html">
                  <i class="fas fa-clipboard-list"></i>
                  <span>日志审计</span>
                  <span class="badge" id="log-count">0</span>
                </a>
              </li>
            </ul>
          </div>
        </nav>

        <div class="sidebar-footer">
          <button id="logout-btn" class="logout-btn">
            <i class="fas fa-sign-out-alt"></i>
            <span>退出登录</span>
          </button>
        </div>
      </aside>

      <!-- 主内容区 -->
      <main class="main-content">
        <header class="top-header">
          <div class="header-left">
            <h1>日志审计</h1>
            <p class="subtitle">监控和审计系统所有操作记录</p>
          </div>
          <div class="header-right">
            <div class="header-actions"></div>
          </div>
        </header>

        <div class="content-wrapper">
          <!-- 过滤面板 -->
          <section class="filter-section">
            <div class="filter-header">
              <h3><i class="fas fa-filter"></i> 筛选条件</h3>
            </div>

            <div class="filter-grid">
              <div class="filter-group">
                <label for="userFilter"
                  ><i class="fas fa-user"></i> 用户ID</label
                >
                <input
                  type="number"
                  id="userFilter"
                  placeholder="输入用户ID..."
                />
              </div>

              <div class="filter-group">
                <label for="actionFilter"
                  ><i class="fas fa-cog"></i> 操作类型</label
                >
                <select id="actionFilter">
                  <option value="">所有操作</option>
                  <option value="USER_LOGIN">用户登录</option>
                  <option value="USER_LOGIN_FAILURE">登录失败</option>
                  <option value="USER_CREATE">创建用户</option>
                  <option value="USER_UPDATE">更新用户</option>
                  <option value="USER_DELETE">删除用户</option>
                  <option value="COURSE_CREATE">创建课程</option>
                  <option value="COURSE_UPDATE">更新课程</option>
                  <option value="COURSE_DELETE">删除课程</option>
                  <option value="GRADE_UPDATE">成绩更新</option>
                  <option value="BACKUP_CREATE">创建备份</option>
                  <option value="SYSTEM_CONFIG">系统配置</option>
                </select>
              </div>

              <div class="filter-group">
                <label for="ipFilter"
                  ><i class="fas fa-network-wired"></i> IP地址</label
                >
                <input type="text" id="ipFilter" placeholder="输入IP地址..." />
              </div>

              <div class="filter-group">
                <label for="dateRange"
                  ><i class="fas fa-calendar-alt"></i> 日期范围</label
                >
                <input
                  type="text"
                  id="dateRange"
                  placeholder="选择日期范围..."
                />
              </div>

              <div class="filter-group">
                <label for="statusFilter"
                  ><i class="fas fa-flag"></i> 状态</label
                >
                <select id="statusFilter">
                  <option value="">所有状态</option>
                  <option value="success">成功</option>
                  <option value="failure">失败</option>
                  <option value="warning">警告</option>
                </select>
              </div>
            </div>
          </section>

          <!-- 日志统计卡片 -->
          <section class="stats-section">
            <div class="stats-cards">
              <div class="stat-card">
                <div class="stat-icon total">
                  <i class="fas fa-list"></i>
                </div>
                <div class="stat-info">
                  <h4>总日志数</h4>
                  <div class="stat-value" id="totalLogsCount">0</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon success">
                  <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-info">
                  <h4>成功操作</h4>
                  <div class="stat-value" id="successLogsCount">0</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon failure">
                  <i class="fas fa-times-circle"></i>
                </div>
                <div class="stat-info">
                  <h4>失败操作</h4>
                  <div class="stat-value" id="failureLogsCount">0</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon security">
                  <i class="fas fa-shield-alt"></i>
                </div>
                <div class="stat-info">
                  <h4>安全事件</h4>
                  <div class="stat-value" id="securityLogsCount">0</div>
                </div>
              </div>
            </div>
          </section>

          <!-- 日志表格 -->
          <section class="logs-section">
            <div class="section-header">
              <h3 class="section-title">操作日志</h3>
              <div class="table-actions">
                <div class="pagination-info">
                  显示
                  <select id="pageSize" onchange="changePageSize()">
                    <option value="10">10</option>
                    <option value="25" selected>25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                  </select>
                  条记录
                </div>
                <div class="pagination-controls">
                  <button id="prevPage" onclick="prevPage()" disabled>
                    <i class="fas fa-chevron-left"></i>
                  </button>
                  <span id="currentPage">1</span> /
                  <span id="totalPages">1</span>
                  <button id="nextPage" onclick="nextPage()" disabled>
                    <i class="fas fa-chevron-right"></i>
                  </button>
                </div>
              </div>
            </div>

            <div class="logs-table-container">
              <table class="logs-table" id="logsTable">
                <thead>
                  <tr>
                    <th width="60px">ID</th>
                    <th width="120px">时间</th>
                    <th width="100px">用户</th>
                    <th width="150px">操作类型</th>
                    <th>详情</th>
                    <th width="120px">IP地址</th>
                    <th width="100px">状态</th>
                    <th width="120px">操作</th>
                  </tr>
                </thead>
                <tbody id="logsTableBody">
                  <!-- 日志数据将通过JavaScript填充 -->
                  <tr class="loading-row">
                    <td colspan="8">
                      <div class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i> 正在加载日志...
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </div>

        <footer class="main-footer">
          <p>
            © 2025 成绩管理教学平台 - 日志审计系统 | 最后更新:
            <span id="last-update">今天 10:30</span>
          </p>
          <p class="footer-links">
            <a href="index.html">返回控制面板</a> |
            <a href="#" onclick="refreshLogs()">刷新日志</a> |
            <a href="#" onclick="exportLogs()">导出数据</a>
          </p>
        </footer>
      </main>
    </div>

    <!-- 日志详情弹窗 -->
    <div class="modal" id="logDetailModal">
      <div class="modal-content large">
        <div class="modal-header">
          <h3><i class="fas fa-info-circle"></i> 日志详情</h3>
          <button class="close-modal" onclick="closeModal('logDetailModal')">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div class="detail-grid">
            <div class="detail-item">
              <label>日志ID</label>
              <div class="detail-value" id="detail-id">-</div>
            </div>
            <div class="detail-item">
              <label>时间</label>
              <div class="detail-value" id="detail-time">-</div>
            </div>
            <div class="detail-item">
              <label>用户</label>
              <div class="detail-value" id="detail-user">-</div>
            </div>
            <div class="detail-item">
              <label>操作类型</label>
              <div class="detail-value" id="detail-action">-</div>
            </div>
            <div class="detail-item">
              <label>IP地址</label>
              <div class="detail-value" id="detail-ip">-</div>
            </div>
            <div class="detail-item">
              <label>状态</label>
              <div class="detail-value" id="detail-status">-</div>
            </div>
            <div class="detail-item full">
              <label>详细内容</label>
              <div class="detail-value" id="detail-content">-</div>
            </div>
            <div class="detail-item full">
              <label>请求数据</label>
              <div class="detail-value">
                <pre id="detail-request">无</pre>
              </div>
            </div>
            <div class="detail-item full">
              <label>响应数据</label>
              <div class="detail-value">
                <pre id="detail-response">无</pre>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button
            class="btn btn-outline"
            onclick="closeModal('logDetailModal')"
          >
            关闭
          </button>
          <button class="btn btn-primary" onclick="copyLogDetails()">
            <i class="fas fa-copy"></i> 复制详情
          </button>
        </div>
      </div>
    </div>

    <!-- 清空日志确认弹窗 -->
    <div class="modal" id="clearLogsModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-exclamation-triangle"></i> 确认清空日志</h3>
          <button class="close-modal" onclick="closeModal('clearLogsModal')">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div class="warning-message">
            <i class="fas fa-exclamation-circle"></i>
            <h4>警告：此操作不可逆！</h4>
            <p>
              您确定要清空所有系统日志吗？这将删除所有操作记录，包括安全审计信息。
            </p>
            <p>建议在执行此操作前先导出当前日志。</p>
          </div>
          <div class="confirmation-input">
            <label for="confirmText">请输入 "DELETE LOGS" 以确认：</label>
            <input type="text" id="confirmText" placeholder="DELETE LOGS" />
          </div>
        </div>
        <div class="modal-footer">
          <button
            class="btn btn-outline"
            onclick="closeModal('clearLogsModal')"
          >
            取消
          </button>
          <button
            class="btn btn-danger"
            onclick="confirmClearLogs()"
            disabled
            id="confirmClearBtn"
          >
            <i class="fas fa-trash-alt"></i> 确认清空
          </button>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/l10n/zh.js"></script>
    <script src="logs-script.js"></script>
  </body>
</html>
