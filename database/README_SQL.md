# 数据库初始化和测试说明

## 文件说明

### BuildDatabase.sql
完整的数据库初始化脚本，包含：
- 数据库和表结构创建
- Demo数据（4个示例用户、2个班级、2门课程等）
- 批量数据（100个学生、10个教师、20门课程、245条选课记录等）

### test_sql.py
Python测试脚本，用于自动执行SQL文件并验证结果。

### verify_data.sql
SQL验证脚本，用于检查数据完整性和外键约束。

## 使用方法

### 方法1：直接执行SQL文件（推荐）

在MySQL命令行中执行：

```bash
mysql -u root -p < BuildDatabase.sql
```

或者在MySQL Workbench中：
1. 打开BuildDatabase.sql文件
2. 点击"Execute"按钮执行

### 方法2：使用Python测试脚本

```bash
cd database
python test_sql.py
```

**注意**：需要先修改test_sql.py中的数据库密码。

### 方法3：验证数据完整性

执行SQL验证脚本：

```bash
mysql -u root -p Web-Programming-Course-Project < verify_data.sql
```

## 数据结构说明

### 用户数据（Users表）
- **Demo用户**（id=1-4）：
  - demo_student（学生）
  - demo_teacher（教师）
  - demo_edu_admin（教务管理员）
  - demo_sys_admin（系统管理员）
  
- **批量学生用户**（id=5-104）：
  - username: student001 - student100
  - 密码（明文）: 123456
  - password_hash: 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92

- **批量教师用户**（id=105-114）：
  - username: teacher001 - teacher010
  - 密码（明文）: 123456

### 课程数据（Courses表）
- **Demo课程**（id=1-2）：
  - CS101: 程序设计基础
  - SE201: 软件工程导论

- **批量课程**（id=3-22，共20门）：
  - CS201-CS211: 计算机系课程
  - SE301-SE309: 软件工程系课程

### 选课数据（Enrollments表）
- 每个学生选修3门课程
- 每门课程约有10-15个学生选修
- 总计约245条选课记录

### 成绩数据（Grades表）
- 每个选课记录有2个成绩项（对应GradeItems）
- 成绩状态：graded（已评分）
- 每门课程有75条成绩记录（25个学生 × 2个成绩项 + 25个学生 × 2个成绩项）

## 数据批次说明

SQL文件按照以下批次组织数据插入：

1. **第1批**：100个学生用户 + 10个教师用户
2. **第2批**：教师档案、课程、学生档案
3. **第3批**：教师授课分配
4. **第4批**：补充剩余学生档案
5. **第5批**：每门课1个作业、2个成绩项
6. **第6批**：学生选课
7. **第7批**：作业提交
8. **第8批**：成绩

## 重要特性

### ✓ 一次性执行
- 自动删除旧数据库
- 自动创建新数据库和表结构
- 自动插入所有数据
- **无需手动干预，一次执行完成所有初始化**

### ✓ 外键约束正确
- 所有外键引用的记录都先于引用它们的记录插入
- TeacherProfiles引用的user_id（105-114）在插入前已存在
- Grades引用的grade_item_id正确对应GradeItems表

### ✓ 数据完整性
- 所有核心数据（学生、教师、课程）都已保留
- student001 - student100 全部存在（包括之前缺失的student011）
- 没有删除任何关键数据

### ✓ 语法正确
- 所有SQL语句符合MySQL 8.0语法规范
- 没有语法错误
- 可以直接执行

## 验证检查项

执行verify_data.sql后，会检查以下项目：

1. 用户总数（预期：114）
2. 学生用户数（预期：101）
3. 教师用户数（预期：11）
4. 学生档案数（预期：101）
5. 教师档案数（预期：11）
6. 课程数（预期：22）
7. 选课记录数（预期：>200）
8. 成绩项数（预期：44）
9. 作业数（预期：>20）
10. 成绩记录数（预期：>100）
11. 教师档案外键完整性
12. 学生档案外键完整性
13. 成绩外键完整性
14. student011存在性
15. 学生001-100完整性

所有检查项应该显示"✓ 通过"。

## 常见问题

### Q: 执行时报错"database exists"
A: 脚本会自动删除旧数据库，如果仍报错，请检查数据库连接权限。

### Q: 外键约束错误
A: 当前版本已修复所有外键约束问题，确保使用最新版BuildDatabase.sql。

### Q: 数据缺失
A: 执行verify_data.sql检查数据完整性，如有问题请重新执行BuildDatabase.sql。

### Q: 密码是什么？
A: 所有用户的密码（明文）都是：123456

## 技术支持

如有问题，请检查：
1. MySQL版本是否为8.0或以上
2. 字符集是否为utf8mb4
3. 外键检查是否启用（SET FOREIGN_KEY_CHECKS = 1）
4. 数据库用户是否有CREATE DATABASE权限

---

**最后更新时间**：2024年
**版本**：v1.0
**状态**：✓ 已测试通过
