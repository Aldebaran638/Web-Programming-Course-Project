# 管理端功能测试计划（教学管理端 + 系统管理端）

> 适用范围：`admin_page/edu-admin.html`（教学管理端） 和 `admin_page/index.html`、`logs.html`、`backup.html`（系统管理端）。
>
> 测试数据库：使用 [database/BuildDatabase.sql](../database/BuildDatabase.sql) 初始化得到的数据库。
>
> 主要测试账号：
> - 教学管理员：`demo_edu_admin` / 密码 `123456`（与其他 demo 账号相同哈希）
> - 系统管理员：`demo_sys_admin` / 密码 `123456`
>
> 公共前置条件：
> 1. 已执行 BuildDatabase.sql，且所有表与示例数据成功创建。
> 2. 后端 FastAPI 在 `http://127.0.0.1:8000` 运行，前端通过统一网关 `aldebaran/page.html` 登录。
> 3. 使用浏览器访问统一网关，登录后自动跳转到对应管理端页面。

---

## 一、教学管理端（edu-admin.html）测试

### T-E1 班级管理 - 列表与新增

**前置数据（来自 BuildDatabase.sql）**
- `Classes` 表中已有：
  - `软件工程2101班`（id=1）
  - `计算机2102班`（id=2）

**步骤**
1. 以 `demo_edu_admin` 账号登录网关，进入“教学管理端”。
2. 左侧菜单点击“班级管理”。
3. 观察班级列表。
4. 点击“新增班级”，输入：
   - 班级名称：`软件工程2103班`
   - 所在院系：`软件工程系`
   - 入学年份：`2021`
5. 保存。

**预期结果**
- 列表中至少包含两条初始数据：`软件工程2101班`、`计算机2102班`。
- 新增后，列表中出现 `软件工程2103班`，院系为“软件工程系”。
- 刷新页面后数据仍然存在（说明已成功写入数据库）。

---

### T-E2 学生管理 - 查询 demo_student

**前置数据**
- `StudentProfiles` 中有：
  - user_id=1，对应 `demo_student`，
  - `student_id_number = 20250001`，`full_name = 示例学生`，`class_id = 1`。

**步骤**
1. 在教学管理端，点击“学生管理”。
2. 在搜索框输入 `20250001` 或 `示例学生`。
3. 点击回车或等待自动过滤。

**预期结果**
- 列表中至少有一行：
  - 学号：`20250001`
  - 姓名：`示例学生`
  - 班级：`软件工程2101班`
- 点击该行“编辑”后（如果实现），弹窗/侧边栏中信息与数据库一致。

---

### T-E3 教师管理 - demo_teacher 信息

**前置数据**
- `TeacherProfiles` 中有：
  - 对应 `demo_teacher` 的教师档案：
    - `teacher_id_number = T20250001`
    - `full_name = 示例教师`
    - `title = 教授`

**步骤**
1. 在教学管理端，点击“教师管理”。
2. 在搜索框输入 `示例教师` 或 `T20250001`。

**预期结果**
- 列表中存在一行：
  - 教师编号：`T20250001`
  - 姓名：`示例教师`
  - 职称：`教授`。

---

### T-E4 课程管理 - 查看示例课程

**前置数据**
- `Courses` 表：
  - `CS101` - `程序设计基础` - 学分 `3.0`
  - `SE201` - `软件工程导论` - 学分 `2.5`

**步骤**
1. 在教学管理端，点击“课程管理”。
2. 不填筛选条件，直接查看列表第一页。

**预期结果**
- 列表中至少包含：
  - 课程代码 `CS101`，名称为 `程序设计基础`，学分 `3.0`；
  - 课程代码 `SE201`，名称为 `软件工程导论`，学分 `2.5`。

---

### T-E5 教室管理 - 查看示例教室

**前置数据**
- `Classrooms` 表：
  - id=1：`A101`，地点 `一号楼`，容量 `60`
  - id=2：`B202`，地点 `二号楼`，容量 `40`

**步骤**
1. 在教学管理端，点击“教室管理”。

**预期结果**
- 列表中显示 `A101` 和 `B202`，对应容量和位置正确。

---

### T-E6 学期开课计划 - 查看示例授课任务

**前置数据**
- `TeachingAssignments` 表：
  - id=1：teacher_id=1（示例教师），course_id=1（CS101），semester=`2023-2024-1`
  - id=2：teacher_id=1，course_id=2（SE201），semester=`2024-2025-1`

**步骤**
1. 在教学管理端，点击“教学安排”。
2. 在“授课任务列表”区域，将学期选择/输入为 `2023-2024-1`（如果有学期筛选）。

**预期结果**
- 授课任务列表中至少有一行：
  - 授课任务ID：`1`
  - 学期：`2023-2024-1`
  - 课程：`程序设计基础（CS101）` 或类似文案；
  - 教师：`示例教师`。

---

### T-E7 学期开课计划 - 新增授课任务

**步骤**
1. 在“教学安排”页，点击“分配授课教师”。
2. 在课程下拉框中选择 `软件工程导论 (SE201)`。
3. 在教师下拉中选择 `示例教师`。
4. 在学期下拉中选择一个当前学期，例如 `2025-2026-1`。
5. 提交。

**预期结果**
- 提示“教师分配成功”。
- 授课任务列表中出现一条新记录，课程为 `软件工程导论`，教师为 `示例教师`，学期为刚才选择的学期。

---

### T-E8 教室安排管理 - 查看现有课程安排

**前置数据**
- `CourseSchedules` 表：
  - 一条记录：`teaching_id=1`，`classroom_id=1`，`day_of_week='Mon'`，`start_time='08:00:00'`，`end_time='09:40:00'`。

**步骤**
1. 在“教学安排”页，切换到课表视图（如果有）。
2. 确保当前学期选择的是 `2023-2024-1`。

**预期结果**
- 在周一 `1-2节 (08:00-09:40)` 对应的格子中，显示：
  - 课程名称：`程序设计基础`（或类似），
  - 教室：`A101`。

---

### T-E9 教室安排管理 - 新增一条课程排课

**步骤**
1. 在“教学安排”页，点击课表上空白格子（例如周二 3-4节），或点击“安排课程”按钮。
2. 在课程下拉中选择某个授课任务（如 `程序设计基础 - 示例教师`）。
3. 在教室下拉中选择 `B202`。
4. 星期选择 `Tue`，时间节次选择 `3-4节 (10:10-11:50)`。
5. 提交。

**预期结果**
- 提示“课程安排成功”。
- 课表周二 3-4 节格子中显示对应课程和教室信息。
- 刷新页面后，该排课仍存在。

---

### T-E10 课程表查询 - 按教师查询

**步骤**
1. 在教学管理端左侧菜单点击“课程表”。
2. 查询类型选择“按教师”，下拉选择 `示例教师`。
3. 学期输入或选择 `2023-2024-1`。
4. 点击“查询”。

**预期结果**
- 查询结果表格中，至少包含：
  - 周一 1-2 节，对应课程 `程序设计基础`，教室 `A101`；
  - 以及 T-E9 新增的其它时段（如存在）。

---

### T-E11 成绩审核 - 加载待审核列表

**前置数据**
- `Grades` 表中已有两条记录，`status='graded'`，
- 后端接口会根据逻辑汇总“待审核课程”，此处关注接口是否正常返回。

**步骤**
1. 在教学管理端，点击左侧“成绩审核”。
2. 等待页面加载完成。

**预期结果**
- 若存在待审核课程：表格中列出对应课程、班级、人数等信息；
- 若当前实现逻辑认为示例数据已“无待审核项”，则页面应给出“暂无待审核记录”等友好提示，而非报错。

---

### T-E12 成绩发布 - 发布一门课程成绩

> 注：具体是否能发布取决于当前后台实现状态；此用例更多用于检查前端与接口联通是否正常。

**步骤**
1. 在教学管理端，点击“成绩发布”。
2. 若列表中有可发布的课程，勾选其中一门。
3. 点击“发布成绩”，在确认弹窗中确认。

**预期结果**
- 前端提示“成绩发布成功”或类似；
- 该课程在列表中的状态从“待发布”变为“已发布”（如果有状态列）。

---

## 二、系统管理端（index.html / logs.html / backup.html）测试

### T-S1 登录与权限校验

**步骤**
1. 使用 `demo_sys_admin` 通过统一网关登录。
2. 登录成功后，从门户进入“系统管理端”（或直接访问 `admin_page/index.html`，此时应校验 token 和角色）。

**预期结果**
- 成功进入系统管理端首页，右上角用户名显示为 `demo_sys_admin`（或对应用户名）。
- 若使用非 sys_admin 角色访问 `index.html`，会被重定向回网关 `aldebaran/page.html`。

---

### T-S2 仪表板瘦身检查

**步骤**
1. 登录到系统管理端首页。

**预期结果**
- 左侧菜单中“快速操作”只保留“立即备份”和“查看错误日志”，不再有“系统状态”假入口。
- 中间“核心管理功能”区域只包含：
  - 日志审计卡片；
  - 备份与恢复卡片；
  - 不再出现“系统健康”一类假监控卡片。
- 页面下方不再出现“系统概览（总用户数/课程数量/安全事件等）”虚构统计模块。
- 不再有“系统状态”弹窗（点击任何按钮不会弹出假监控面板）。

---

### T-S3 日志审计入口

**前置数据**
- `Logs` 表中有一条示例记录：
  - `action = 'USER_LOGIN'`，`details = '登录成功'`，`ip_address = '127.0.0.1'`。

**步骤**
1. 在系统管理端首页：
   - 点击顶部按钮“日志审计”；或
   - 点击左侧菜单“日志审计”；或
   - 点击“核心管理功能”里的“日志审计”卡片。
2. 进入 `logs.html` 页面后，保持默认条件，点击“查询”（如果需要）。

**预期结果**
- 日志列表中应至少显示 1 条日志：
  - 操作类型包含 `USER_LOGIN`；
  - 详情中包含“登录成功”；
  - IP 地址为 `127.0.0.1`；
- 顶部统计中的“日志总数”≥1。

---

### T-S4 查看错误日志快速入口

**步骤**
1. 在系统管理端首页左侧“快速操作”里点击“查看错误日志”。
2. 观察跳转后的 `logs.html` 页面的过滤条件。

**预期结果**
- 页面 URL 包含 `?action=ERROR` 或等效参数。
- 日志列表按“错误类型”过滤（如果有实现）；
- 若暂无错误日志，展示“暂无记录”而不是前端报错。

---

### T-S5 立即备份（首页入口）

**步骤**
1. 在系统管理端首页左侧“快速操作”中点击“立即备份”。
2. 在浏览器弹出的确认对话框中选择“确定”。

**预期结果**
- 前端弹出提示，例如 `备份任务已启动，任务ID: xxx`。
- 页脚左下角的“最后备份”提示从“从未备份”更新为“刚刚”。
- 不出现 JS 报错；后端 `/api/v1/system/backups` 接口返回 200 和 JSON（至少包含一个 `task_id` 字段）。

---

### T-S6 立即备份（备份页面入口）

**步骤**
1. 在系统管理端首页点击“备份与恢复”卡片或顶部按钮，进入 `backup.html`。
2. 在页面中选择“完整备份”或“增量备份”。

**预期结果**
- 触发真实后端备份接口 `/api/v1/system/backups`；
- 页面显示备份进度条或状态动画；
- 完成后提示“备份完成”或类似文本。

---

### T-S7 单个资源恢复

**准备 SQL（在数据库中执行）：**

```sql
-- 将示例课程 SE201 标记为逻辑删除，用于恢复测试
UPDATE Courses SET is_deleted = 1 WHERE course_code = 'SE201';
```

**步骤**
1. 以 `demo_sys_admin` 登录，进入 `backup.html`。
2. 在“恢复单个资源”或类似区域：
   - 资源类型输入/选择：`courses`；
   - 资源 ID 输入：对应 `SE201` 的 `id`（根据 BuildDatabase.sql，该课程 id=2）。
3. 确认执行恢复操作（按页面提示输入 `CONFIRM RESTORE` 等）。

**预期结果**
- 前端提示“恢复成功”或类似；
- 数据库中 `Courses` 表对应行的 `is_deleted` 从 `1` 变为 `0`；
- 若页面有列表刷新功能，刷新后该课程重新出现在正常课程列表中。

---

### T-S8 未登录/角色错误访问拦截

**步骤**
1. 清除浏览器的 `localStorage` 中的 `token` 和 `user`。
2. 直接在地址栏访问 `admin_page/index.html` 或 `admin_page/logs.html`。
3. 或者使用非 `sys_admin` 账号登录后，手动输入 `admin_page/index.html`。

**预期结果**
- 均会被重定向到统一网关登录页 `aldebaran/page.html`；
- 不会短暂闪现系统管理页面内容。

---

## 三、补充建议

- 如需对接口做更细粒度的测试，可在此文档基础上再拆分为：
  - `admin_api_test_plan.md`：面向接口调试（直接调用 FastAPI 路由）。
  - 当前文档偏向“从页面出发”的端到端测试。
- 若后续在数据库中增加更多示例数据（例如更多课程、更多日志），建议同步扩展本测试文档中的预期结果说明。